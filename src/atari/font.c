#include <stdint.h>
#include <string.h>
#include <atari.h>
#include <peekpoke.h>

#include "font.h"
#include "screen.h"

#define FONT_SIZE 1024
#define PATCH_OFFSET 64 * 8


const unsigned char font_patch[] = {
  	56,124,124,56,56,16,16,0,
	0,30,14,14,18,32,32,32,
	3,3,3,3,3,3,3,3,
	16,16,16,16,224,0,0,0,
	0,120,112,112,72,4,4,4,
	0,0,0,0,224,16,16,16,
	24,24,48,92,16,40,72,0,
	0,0,56,68,255,255,102,0,
	0,6,98,62,66,165,66,0,
	0,252,34,34,254,254,24,0,
	0,248,68,254,254,254,48,255,
	0,248,80,254,254,252,85,170,
	16,56,124,16,40,40,68,130,
	0,78,6,74,16,32,64,64,
	0,32,24,128,255,12,24,32,
	0,0,0,64,62,0,36,0,
	60,66,145,145,157,129,66,60,
	0,0,0,0,15,16,16,16,
	0,0,0,0,255,0,0,0,
	24,24,24,255,255,24,24,24,
	0,124,84,127,85,127,85,0,
	24,60,126,255,74,122,122,0,
	192,192,192,192,192,192,192,192,
	0,0,0,255,255,24,24,24,
	24,24,24,255,255,0,0,0,
	16,16,16,16,16,16,16,16,
	16,16,16,16,15,0,0,0,
	120,96,120,96,126,24,30,0,
	0,24,60,126,24,24,24,0,
	0,24,24,24,126,60,24,0,
	0,32,96,252,98,34,2,2,
	0,4,6,63,70,68,64,64
};

void patch_font(void) {
	char *original = (char *)(PEEK(756) << 8);

	memcpy(font_mem, original, FONT_SIZE);
	memcpy(font_mem + PATCH_OFFSET, font_patch, sizeof(font_patch));

	POKE(756, ((unsigned int)font_mem) >> 8);
}
